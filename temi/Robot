package com.example.temicontrolapp;

import com.robotemi.sdk.Robot;
import java.io.IOException;
import java.net.*;
import java.util.Enumeration;

import fi.iki.elonen.NanoHTTPD;

public class TemiHttpServer extends NanoHTTPD {

    public TemiHttpServer() throws IOException {
        super(8080); // í¬íŠ¸ ë²ˆí˜¸
        start(SOCKET_READ_TIMEOUT, false);
        System.out.println("âœ… Temi ì„œë²„ ì‹œì‘ë¨: http://192.168.35.173:5555/speak");
    }

    @Override
    public Response serve(IHTTPSession session) {
        String uri = session.getUri();
        System.out.println("ğŸ“¡ ìš”ì²­ ë°›ìŒ: " + uri);

        if (uri.equals("/speak")) {
            Robot.getInstance().speak("ì™¸ë¶€ì—ì„œ ëª…ë ¹ ë„ì°©!");
            return newFixedLengthResponse("Temiê°€ speak ëª…ë ¹ ë°›ìŒ");
        } else if (uri.equals("/move")) {
            Robot.getInstance().goTo("home base");
            return newFixedLengthResponse("Temiê°€ move ëª…ë ¹ ë°›ìŒ");
        } else {
            return newFixedLengthResponse("â— ì•Œ ìˆ˜ ì—†ëŠ” ëª…ë ¹: " + uri);
        }
    }

    private String getDeviceIpAddress() {
        try {
            for (Enumeration<NetworkInterface> en = NetworkInterface.getNetworkInterfaces(); en.hasMoreElements();) {
                NetworkInterface intf = en.nextElement();
                for (Enumeration<InetAddress> enumIpAddr = intf.getInetAddresses(); enumIpAddr.hasMoreElements();) {
                    InetAddress inetAddress = enumIpAddr.nextElement();
                    if (!inetAddress.isLoopbackAddress() && inetAddress instanceof Inet4Address) {
                        return inetAddress.getHostAddress();
                    }
                }
            }
        } catch (SocketException ex) {
            ex.printStackTrace();
        }
        return "localhost";
    }
}
